const mongoose = require('mongoose');
const dotenv = require('dotenv');
const Brand = require('./src/models/Brand');
const Product = require('./src/models/Product');
const User = require('./src/models/User');

dotenv.config();

const seedData = async () => {
  try {
    await mongoose.connect(process.env.MONGODB_URI);
    console.log('‚úÖ MongoDB Connected');

    // Clear existing data
    await Brand.deleteMany({});
    await Product.deleteMany({});
    console.log('üóëÔ∏è  Cleared existing data');

    // Create brand user
    const brandUser = await User.findOne({ email: 'testapi@test.com' });
    
    if (!brandUser) {
      console.log('‚ùå Please register a user first');
      process.exit(1);
    }

    // Create brands
    const brands = await Brand.create([
      {
        name: 'EcoLife Vietnam',
        logo: 'https://via.placeholder.com/200x200?text=EcoLife',
        coverImage: 'https://via.placeholder.com/1200x400?text=EcoLife+Cover',
        description: 'Th∆∞∆°ng hi·ªáu s·∫£n ph·∫©m xanh h√†ng ƒë·∫ßu Vi·ªát Nam, cam k·∫øt b·∫£o v·ªá m√¥i tr∆∞·ªùng',
        contact: {
          email: 'contact@ecolife.vn',
          phone: '0901234567',
          website: 'https://ecolife.vn',
          address: 'H√† N·ªôi, Vi·ªát Nam'
        },
        partnership: {
          tier: 'platinum',
          commissionRate: 8
        },
        esgCommitment: {
          sustainabilityScore: 95,
          certifications: [
            { name: 'ISO 14001', verifiedDate: new Date() },
            { name: 'B Corp Certified', verifiedDate: new Date() }
          ],
          recyclingProgram: {
            hasProgram: true,
            description: 'Thu gom v√† t√°i ch·∫ø 100% bao b√¨ s·∫£n ph·∫©m',
            materialsAccepted: ['plastic', 'glass', 'paper']
          }
        },
        cashbackSettings: {
          defaultRate: 8,
          maxCashbackPerProduct: 100000
        },
        user: brandUser._id,
        isVerified: true,
        isFeatured: true
      },
      {
        name: 'Green Choice',
        logo: 'https://via.placeholder.com/200x200?text=GreenChoice',
        description: 'L·ª±a ch·ªçn xanh cho cu·ªôc s·ªëng b·ªÅn v·ªØng',
        contact: {
          email: 'hello@greenchoice.vn',
          phone: '0907654321',
          website: 'https://greenchoice.vn'
        },
        partnership: {
          tier: 'gold',
          commissionRate: 10
        },
        esgCommitment: {
          sustainabilityScore: 88,
          recyclingProgram: {
            hasProgram: true,
            materialsAccepted: ['plastic', 'paper']
          }
        },
        user: brandUser._id,
        isVerified: true,
        isFeatured: true
      },
      {
        name: 'Pure Nature',
        logo: 'https://via.placeholder.com/200x200?text=PureNature',
        description: 'S·∫£n ph·∫©m organic t·ª´ thi√™n nhi√™n',
        contact: {
          email: 'info@purenature.vn',
          phone: '0909876543'
        },
        partnership: {
          tier: 'silver',
          commissionRate: 12
        },
        esgCommitment: {
          sustainabilityScore: 92,
          certifications: [
            { name: 'Organic Certified', verifiedDate: new Date() }
          ]
        },
        user: brandUser._id,
        isVerified: true
      }
    ]);

    console.log(`‚úÖ Created ${brands.length} brands`);

    // Create products
    const products = await Product.create([
      // EcoLife Products
      {
        name: 'B·ªô ƒë·ªì ƒÉn tre t·ª± nhi√™n cao c·∫•p',
        description: 'B·ªô ƒë·ªì ƒÉn l√†m t·ª´ tre 100% t·ª± nhi√™n, kh√¥ng ch·ª©a h√≥a ch·∫•t ƒë·ªôc h·∫°i. Ph√¢n h·ªßy sinh h·ªçc sau 6 th√°ng.',
        images: [
          { url: 'https://via.placeholder.com/600x600?text=Bamboo+Set', isMain: true }
        ],
        brand: brands[0]._id,
        category: 'household',
        price: 350000,
        originalPrice: 450000,
        cashback: {
          type: 'percentage',
          value: 8,
          maxAmount: 50000
        },
        packaging: {
          materials: [
            { type: 'paper', percentage: 80, recyclable: true },
            { type: 'biodegradable', percentage: 20, recyclable: true }
          ],
          weight: 500,
          dimensions: { length: 30, width: 20, height: 10 },
          isRecyclable: true,
          recycleReward: 15000
        },
        greenAttributes: {
          isEcoFriendly: true,
          isOrganic: true,
          isVegan: true,
          isCrueltyFree: true,
          certifications: [
            { name: 'FSC Certified' }
          ],
          carbonFootprint: 0.8,
          sustainabilityScore: 95
        },
        sku: 'ECO-BAMBOO-001',
        stock: 100,
        hasQRCode: true
      },
      {
        name: 'T√∫i v·∫£i canvas organic  c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng',
        description: 'T√∫i v·∫£i canvas l√†m t·ª´ b√¥ng organic, b·ªÅn ch·∫Øc, c√≥ th·ªÉ gi·∫∑t m√°y. Thay th·∫ø t√∫i nilon ho√†n h·∫£o.',
        images: [
          { url: 'https://via.placeholder.com/600x600?text=Canvas+Bag', isMain: true }
        ],
        brand: brands[0]._id,
        category: 'fashion',
        price: 120000,
        cashback: {
          type: 'fixed',
          value: 10000
        },
        packaging: {
          materials: [
            { type: 'paper', percentage: 100, recyclable: true }
          ],
          weight: 200,
          isRecyclable: true,
          recycleReward: 8000
        },
        greenAttributes: {
          isEcoFriendly: true,
          isOrganic: true,
          sustainabilityScore: 90
        },
        sku: 'ECO-BAG-001',
        stock: 200,
        hasQRCode: true
      },
      {
        name: 'B√†n ch·∫£i ƒë√°nh rƒÉng tre biodegradable',
        description: 'B√†n ch·∫£i tre v·ªõi l√¥ng b√†n ch·∫£i t·ª´ s·ª£i tre t·ª± nhi√™n. Ph√¢n h·ªßy ho√†n to√†n sau 6-12 th√°ng.',
        images: [
          { url: 'https://via.placeholder.com/600x600?text=Bamboo+Toothbrush', isMain: true }
        ],
        brand: brands[0]._id,
        category: 'personal-care',
        price: 45000,
        cashback: {
          type: 'percentage',
          value: 10
        },
        packaging: {
          materials: [
            { type: 'paper', percentage: 100, recyclable: true }
          ],
          weight: 30,
          isRecyclable: true,
          recycleReward: 3000
        },
        greenAttributes: {
          isEcoFriendly: true,
          isVegan: true,
          isCrueltyFree: true,
          sustainabilityScore: 98
        },
        sku: 'ECO-BRUSH-001',
        stock: 500,
        hasQRCode: true,
        isFeatured: true
      },

      // Green Choice Products
      {
        name: 'N∆∞·ªõc r·ª≠a ch√©n h·ªØu c∆° chi·∫øt xu·∫•t chanh',
        description: 'N∆∞·ªõc r·ª≠a ch√©n t·ª´ nguy√™n li·ªáu t·ª± nhi√™n, kh√¥ng ch·ª©a h√≥a ch·∫•t ƒë·ªôc h·∫°i. An to√†n cho da tay v√† m√¥i tr∆∞·ªùng.',
        images: [
          { url: 'https://via.placeholder.com/600x600?text=Dish+Soap', isMain: true }
        ],
        brand: brands[1]._id,
        category: 'household',
        price: 85000,
        originalPrice: 120000,
        cashback: {
          type: 'percentage',
          value: 7
        },
        packaging: {
          materials: [
            { type: 'plastic', percentage: 100, recyclable: true }
          ],
          weight: 600,
          isRecyclable: true,
          recycleReward: 10000
        },
        greenAttributes: {
          isEcoFriendly: true,
          isOrganic: true,
          isCrueltyFree: true,
          sustainabilityScore: 85
        },
        sku: 'GC-DISH-001',
        stock: 150,
        hasQRCode: true,
        isFeatured: true
      },
      {
        name: 'Gi·∫•y v·ªá sinh tre kh√¥ng t·∫©y tr·∫Øng',
        description: 'Gi·∫•y v·ªá sinh l√†m t·ª´ 100% s·ª£i tre, kh√¥ng t·∫©y tr·∫Øng, m·ªÅm m·∫°i v√† th√¢n thi·ªán v·ªõi m√¥i tr∆∞·ªùng.',
        images: [
          { url: 'https://via.placeholder.com/600x600?text=Bamboo+Tissue', isMain: true }
        ],
        brand: brands[1]._id,
        category: 'household',
        price: 65000,
        cashback: {
          type: 'percentage',
          value: 5
        },
        packaging: {
          materials: [
            { type: 'paper', percentage: 100, recyclable: true }
          ],
          weight: 400,
          isRecyclable: true,
          recycleReward: 5000
        },
        greenAttributes: {
          isEcoFriendly: true,
          sustainabilityScore: 88
        },
        sku: 'GC-TISSUE-001',
        stock: 300,
        hasQRCode: true
      },

      // Pure Nature Products
      {
        name: 'D·∫ßu g·ªôi organic chi·∫øt xu·∫•t b∆∞·ªüi',
        description: 'D·∫ßu g·ªôi t·ª´ tinh d·∫ßu b∆∞·ªüi t·ª± nhi√™n, gi√∫p t√≥c ch·∫Øc kh·ªèe, gi·∫£m r·ª•ng t√≥c. Kh√¥ng ch·ª©a sulfate v√† paraben.',
        images: [
          { url: 'https://via.placeholder.com/600x600?text=Organic+Shampoo', isMain: true }
        ],
        brand: brands[2]._id,
        category: 'personal-care',
        price: 180000,
        cashback: {
          type: 'percentage',
          value: 10
        },
        packaging: {
          materials: [
            { type: 'glass', percentage: 100, recyclable: true }
          ],
          weight: 350,
          isRecyclable: true,
          recycleReward: 12000
        },
        greenAttributes: {
          isEcoFriendly: true,
          isOrganic: true,
          isVegan: true,
          isCrueltyFree: true,
          certifications: [
            { name: 'USDA Organic' }
          ],
          sustainabilityScore: 92
        },
        sku: 'PN-SHAMPOO-001',
        stock: 120,
        hasQRCode: true,
        isFeatured: true
      },
      {
        name: 'Kem d∆∞·ª°ng da organic tinh ch·∫•t tr√† xanh',
        description: 'Kem d∆∞·ª°ng da t·ª´ tinh ch·∫•t tr√† xanh organic, gi√∫p d∆∞·ª°ng ·∫©m v√† ch·ªëng l√£o h√≥a t·ª± nhi√™n.',
        images: [
          { url: 'https://via.placeholder.com/600x600?text=Organic+Cream', isMain: true }
        ],
        brand: brands[2]._id,
        category: 'personal-care',
        price: 250000,
        originalPrice: 320000,
        cashback: {
          type: 'fixed',
          value: 30000
        },
        packaging: {
          materials: [
            { type: 'glass', percentage: 80, recyclable: true },
            { type: 'paper', percentage: 20, recyclable: true }
          ],
          weight: 200,
          isRecyclable: true,
          recycleReward: 15000
        },
        greenAttributes: {
          isEcoFriendly: true,
          isOrganic: true,
          isVegan: true,
          isCrueltyFree: true,
          sustainabilityScore: 94
        },
        sku: 'PN-CREAM-001',
        stock: 80,
        hasQRCode: true,
        isFeatured: true
      },
      {
        name: 'Combo 3 x√† ph√≤ng handmade organic',
        description: 'B·ªô 3 x√† ph√≤ng th·ªß c√¥ng t·ª´ tinh d·∫ßu thi√™n nhi√™n: Lavender, Tr√† xanh, Ngh·ªá m·∫≠t ong.',
        images: [
          { url: 'https://via.placeholder.com/600x600?text=Handmade+Soap', isMain: true }
        ],
        brand: brands[2]._id,
        category: 'personal-care',
        price: 150000,
        cashback: {
          type: 'percentage',
          value: 12
        },
        packaging: {
          materials: [
            { type: 'paper', percentage: 100, recyclable: true }
          ],
          weight: 300,
          isRecyclable: true,
          recycleReward: 10000
        },
        greenAttributes: {
          isEcoFriendly: true,
          isOrganic: true,
          isVegan: true,
          isCrueltyFree: true,
          isFairTrade: true,
          sustainabilityScore: 96
        },
        sku: 'PN-SOAP-COMBO-001',
        stock: 150,
        hasQRCode: true
      }
    ]);

    console.log(`‚úÖ Created ${products.length} products`);

    // Update brand stats
    for (const brand of brands) {
      const productCount = products.filter(p => p.brand.toString() === brand._id.toString()).length;
      brand.stats.totalProducts = productCount;
      await brand.save();
    }

    console.log('‚úÖ Updated brand stats');
    console.log('\nüéâ Seed data created successfully!');
    console.log(`\nüìä Summary:`);
    console.log(`- ${brands.length} Brands`);
    console.log(`- ${products.length} Products`);
    
    process.exit(0);
  } catch (error) {
    console.error('‚ùå Seed error:', error);
    process.exit(1);
  }
};

seedData();
